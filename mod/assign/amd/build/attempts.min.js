define(["jquery","core/templates"],function(a,b){var c={FIELD:"#id_attemptpenalties",MAINDIV:"",PENALTIES_GRID:"#mod_assign_form_attemptpenalties",ADDPENALTY:"div.addpenalty",REMOVEPENALTY:"div.removepenalty",PENALTYITEM:"li.attemptpenalty",ATTEMPTSREOPENED:"#id_attemptreopenmethod",MAXATTEMPTS:"#id_maxattempts"},d=function(d){window.console.log("Removing Penalty "),window.console.log(d);var e=a(d.target).parent().parent();window.console.log(e),e.remove();var g=a(c.PENALTIES_GRID).children().size();if(window.console.log(g),0===g){window.console.log("No Penalties Remain in effect");var h=b.render("mod_assign/nopenaltiesitem");h.done(function(b){a(c.PENALTIES_GRID).empty(),a(c.PENALTIES_GRID).append(b)})}f()},e=function(){if(window.console.log("Adding penalty"),!f())return void window.console.log("Cannot add new penalty");var d=a(c.PENALTYITEM).size();window.console.log(d+" already");var e={penalty:"0"},g=b.render("mod_assign/attemptpenalty",e);g.done(function(b){0===d&&a(c.PENALTIES_GRID).empty(),a(c.PENALTIES_GRID).append(b),f()}),g.fail(function(){})},f=function(){return window.console.log("Checking state of Penalties"),i()?(a(c.ADDPENALTY).removeClass("disabled"),!0):(a(c.ADDPENALTY).addClass("disabled"),!1)},g=function(a){window.console.log("Attempts Re-opened Changed"),window.console.log(a),f()},h=function(a){window.console.log("Max Attempts Changed"),window.console.log(a),f()},i=function(){var b=a(c.ATTEMPTSREOPENED+" option:selected").val();if(window.console.log(b),"none"==b)return!1;var d=a(c.PENALTYITEM).size(),e=a(c.MAXATTEMPTS+" option:selected").val();return window.console.log(e),-1==e?!0:e>d?!0:(d>e&&window.console.log("TODO Remove penalties beyond the end of the number of attempts"),!1)};return{initialize:function(){window.console.log("hello");var i=a("body");this.field=a(c.FIELD),window.console.log(this.field),this.field.hide();var j=b.render("mod_assign/attemptpenalties",[]),k=this;j.done(function(b){window.console.log(b),k.field.after(b),k.mainDiv=a(c.PENALTIES_GRID);var j=k.field.val();window.console.log("Penalties values"+j);var l=null;if(""!==j)try{l=a.parseJSON(j)}catch(m){k.field.val("")}f(),i.on("click",c.REMOVEPENALTY,d),i.on("click",c.ADDPENALTY,e),i.on("change",c.ATTEMPTSREOPENED,g),i.on("change",c.MAXATTEMPTS,h)})}}});