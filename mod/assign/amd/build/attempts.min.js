define(["jquery","core/templates"],function(a,b){var c={FIELD:"#id_attemptpenalties",MAINDIV:"",PENALTIES_GRID:"#mod_assign_form_attemptpenalties",ADDPENALTY:"div.addpenalty",REMOVEPENALTY:"div.removepenalty",PENALTYITEM:"li.attemptpenalty",ATTEMPTSREOPENED:"#id_attemptreopenmethod",MAXATTEMPTS:"#id_maxattempts"},d=function(b){window.console.log("Removing Penalty "),window.console.log(b),a(b.target).parent().remove(),f()},e=function(){if(window.console.log("Adding penalty"),!f())return void window.console.log("Cannot add new penalty");var d=a(c.PENALTYITEM).size();window.console.log(d+" already");var e={penalty:"0"},g=b.render("mod_assign/attemptpenalty",e);g.done(function(b){a(c.PENALTIES_GRID).append(b),f()}),g.fail(function(){})},f=function(){return window.console.log("Checking state of Penalties"),g()?(a(c.ADDPENALTY).removeClass("disabled"),!0):(a(c.ADDPENALTY).addClass("disabled"),!1)},g=function(){var b=a(c.ATTEMPTSREOPENED+" option:selected").val();if(window.console.log(b),"none"==b)return!1;var d=a(c.PENALTYITEM).size(),e=a(c.MAXATTEMPTS+" option:selected").val();return window.console.log(e),-1==e?!0:e>d?!0:!1};return{initialize:function(){window.console.log("hello");var g=a("body");this.field=a(c.FIELD),window.console.log(this.field),this.field.hide();var h=b.render("mod_assign/attemptpenalties",[]),i=this;h.done(function(b){window.console.log(b),i.field.after(b),i.mainDiv=a(c.PENALTIES_GRID);var h=i.field.val();window.console.log("Penalties values"+h);var j=null;if(""!==h)try{j=a.parseJSON(h)}catch(k){i.field.val("")}f(),g.delegate(c.REMOVEPENALTY,"click",d),g.delegate(c.ADDPENALTY,"click",e),g.delegate(c.ATTEMPTSREOPENED,"change",f),g.delegate(c.MAXATTEMPTS,"change",f)})}}});