define(["jquery","core/templates"],function(a,b){var c={FIELD:"#id_attemptpenalties",MAINDIV:"",PENALTIES_GRID:"#mod_assign_form_attemptpenalties",ADDPENALTY:"div.addpenalty",REMOVEPENALTY:"div.removepenalty",PENALTYITEM:"li.attemptpenalty",PENALTYITEMVALUE:"input[type='text'].penaltyvalue",ATTEMPTSREOPENED:"#id_attemptreopenmethod",MAXATTEMPTS:"#id_maxattempts"},d=[],e=function(d){window.console.log("Removing Penalty "),window.console.log(d);var e=a(d.target).parent().parent();window.console.log(e),e.remove();var f=a(c.PENALTIES_GRID).children().size();if(window.console.log(f),0===f){window.console.log("No Penalties Remain in effect");var g=b.render("mod_assign/nopenaltiesitem");g.done(function(b){a(c.PENALTIES_GRID).empty(),a(c.PENALTIES_GRID).append(b)})}i()},f=function(){window.console.log(d);var b=a(c.PENALTYITEMVALUE);window.console.log(b),b.each(function(a,b){window.console.log(a),window.console.log(b)})},g=function(){if(window.console.log("Adding penalty"),!i())return void window.console.log("Cannot add new penalty");var d=a(c.PENALTYITEM).size();window.console.log(d+" already");var e={penalty:"0"},f=b.render("mod_assign/attemptpenalty",e);f.done(function(b){0===d&&a(c.PENALTIES_GRID).empty(),a(c.PENALTIES_GRID).append(b),i()}),f.fail(function(){})},h=function(a){window.console.log("Penalty Value Changed"),window.console.log(a)},i=function(){return window.console.log("Checking state of Penalties"),l()?(a(c.ADDPENALTY).removeClass("disabled"),!0):(a(c.ADDPENALTY).addClass("disabled"),!1)},j=function(a){window.console.log("Attempts Re-opened Changed"),window.console.log(a),i()},k=function(a){window.console.log("Max Attempts Changed"),window.console.log(a),i()},l=function(){var b=a(c.ATTEMPTSREOPENED+" option:selected").val();if(window.console.log(b),"none"==b)return!1;var d=a(c.PENALTYITEM).size(),e=a(c.MAXATTEMPTS+" option:selected").val();return window.console.log(e),-1==e?!0:e>d?!0:(d>e&&window.console.log("TODO Remove penalties beyond the end of the number of attempts"),!1)};return{initialize:function(){window.console.log("hello");var d=a("body");this.field=a(c.FIELD),window.console.log(this.field),this.field.hide();var l=b.render("mod_assign/attemptpenalties",[]),m=this;l.done(function(b){window.console.log(b),m.field.after(b),m.mainDiv=a(c.PENALTIES_GRID);var l=m.field.val();window.console.log("Penalties values"+l);var n=null;if(""!==l)try{n=a.parseJSON(l)}catch(o){m.field.val("")}i(),d.on("click",c.REMOVEPENALTY,e),d.on("click",c.ADDPENALTY,g),d.on("click","#test",f),d.on("change",c.ATTEMPTSREOPENED,j),d.on("change",c.MAXATTEMPTS,k),d.on("change",c.PENALTYITEMVALUE,h)})}}});